<html>
<meta charset="utf-8" />
	<head>
		<script src="https://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
		<script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
		<script src="https://static.robotwebtools.org/keyboardteleopjs/current/keyboardteleop.min.js"></script>
	</head>

	<script type ="text/javascript">
		var ros = new ROSLIB.Ros({
			url : 'ws://localhost:9090'
		});

		ros.on('connection', function() {
			console.log('Connected to websocket server.');
		});

		ros.on('error', function(error) {
			console.log('Error connecting to websocket server: ', error);
		});

		ros.on('close', function() {
			console.log('Connection to websocket server closed.');
		});

	    // var teleop = new KEYBOARDTELEOP.Teleop({
		   //  ros : ros,
		   //  topic : '/cmd_vel'
	    // });

		// Publishing a topic
		var cmdVel = new ROSLIB.Topic({
			ros : ros,
			name : '/cmd_vel',
			messageType : 'geometry_msgs/Twist'
		});
		cmdVel.advertise();
		var twist = new ROSLIB.Message({
			linear : {
				x : 0.0,
				y : 0.0,
				z : 0.0
			},
			angular : {
				x : 0.0,
				y : 0.0,
				z : 0.0 
			}
		});

		function setTwist(x,z){
			twist.linear.x = x;
			twist.angular.z = z;
			console.log("Publishing to /cmd_vel, x="+x+" , z="+z);
		 	cmdVel.publish(twist);
		}

		var cmd = '';
		var repeater;

		function doWork() {
		 if(cmd=='w'){
		 	setTwist(1,0);
		 }
		 else if(cmd=='s'){
		 	setTwist(-1,0);
		 }
		 else if(cmd=='a'){
		 	setTwist(0,1);
		 }
		 else if(cmd=='d'){
		 	setTwist(0,-1);
		 }
		 else{
		 	setTwist(0,0);
		 }
		 repeater = setTimeout(doWork, 200);
		}
		doWork();

			
	</script>

	<body>
		<h1>- MedibotV4 web interface -</h1>
		
	</body>
</html>